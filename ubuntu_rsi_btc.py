from binance.client import Client
import key
import time
import pandas as pd
import pandas_ta as ta
import send_msg as tele
import numpy as np
from scipy.stats import linregress
import movingaverage as mov

matris = ['55916.5', '56001.2', '57487.86', '54123.4', '48880.43', '50624.84', '46800.42', '46340.31', '46155.87',
          '45113.92', '49618.43', '48356.04', '50477.7', '48448.91', '48861.38', '48881.59', '51169.7', '52299.33',
          '54881.52', '55997.23', '57764.0', '57253.28', '61258.73', '59133.47', '55754.72', '56872.38', '58913.0',
          '57665.9', '58075.1', '58085.8', '57411.17', '54204.96', '54477.46', '52508.23', '51415.92', '55074.47',
          '55863.93', '55783.71', '57627.67', '58730.13', '58735.25', '58736.92', '59031.32', '57076.49', '58206.55',
          '59054.1', '58020.46', '55947.27', '58048.59', '58102.58', '59774.0', '59964.87', '59834.74', '63554.44',
          '62969.12', '63252.63', '61455.98', '60087.09', '56251.48', '55703.14', '56507.91', '53808.8', '51731.71',
          '51153.13', '50110.53', '49075.58', '54056.64', '55071.46', '54884.1', '53584.15', '57796.62', '57857.5',
          '56610.46', '57213.33', '53241.72', '57473.23', '56428.16', '57380.27', '58928.81', '58280.73', '55883.5',
          '56750.0', '49007.09', '49702.27', '49922.52', '46736.58', '46441.64', '43596.24', '42912.19', '36964.27',
          '40784.32', '37280.35', '37528.3', '34754.54', '38728.59', '38410.5', '39266.04', '38445.29', '35689.62',
          '34647.67', '35684.59', '37310.54', '36662.64', '37585.24', '39188.59', '36885.51', '35530.38', '35816.17',
          '33514.87', '33450.19', '37338.36', '36704.57', '37313.18', '35494.9', '39066.82', '40525.8', '40188.56',
          '38324.87', '38068.04', '35729.82', '35524.17', '35592.35', '31686.55', '32447.59', '33674.66', '34639.38',
          '31640.58', '32160.91', '34644.45', '34456.67', '35847.7', '35047.36', '33536.88', '33856.86', '34688.98',
          '35309.3', '33747.97', '34211.01', '33839.04', '32877.41', '33818.52', '33515.57', '34227.64', '33158.25',
          '32686.56', '32814.61', '31738.59', '31421.25', '31520.66', '31783.49', '30815.94', '29790.24', '32118.06',
          '32297.89', '33581.63', '34279.34', '35365.2', '37318.14', '39405.95', '40002.53', '40005.93', '42214.15',
          '41659.06', '40000.46', '39193.94', '38138.0', '39750.14', '40882.0', '42825.95', '44634.13', '43816.14',
          '46333.46', '45608.37', '45611.46', '44417.78', '47833.98', '47112.19', '47056.41', '45982.55', '44648.57',
          '44777.86', '46734.65', '49327.75', '48932.02', '49335.68', '49523.5', '47744.58', '48972.09', '46962.8',
          '49056.86', '48897.65', '48806.78', '47074.77', '47155.87', '48862.76', '49329.01', '50035.33', '49947.38',
          '51769.06', '52677.4', '46809.17', '46078.38', '46368.69', '44847.48', '45144.79', '46059.12', '44968.76',
          '47072.12', '48167.85', '47785.26', '47263.6', '48259.45', '47249.38', '42901.56', '40619.27', '43604.76',
          '44888.96', '42815.56', '42742.01', '43182.63', '42238.2', '41011.16', '41522.38', '43757.81', '48140.11',
          '47727.1', '48205.72', '49143.95', '51505.83', '55343.76', '53801.1', '53867.3', '55122.59', '54625.74',
          '57452.01', '56242.94', '57406.69', '57397.74', '61641.17', '60948.78', '61546.21', '61971.59', '64287.64',
          '66063.56', '62354.86', '60697.06', '61277.28', '60884.18', '63070.54', '60345.17', '58538.49', '60587.09',
          '62249.18', '61731.29', '61373.44', '61029.5', '63241.11', '62954.86', '61441.83', '61072.32', '61516.31',
          '63293.22', '67562.17', '66954.11', '64976.73', '64838.81', '64254.67', '64420.94', '65468.75', '63584.25',
          '60172.26', '60381.35', '56921.34', '58133.02', '59777.98', '58755.9', '56301.52', '57578.22', '57187.54',
          '58935.45', '53588.21', '54801.15', '57292.28', '57828.45', '57025.79', '57229.76', '56508.48', '53713.84',
          '49253.86', '49380.43', '50564.63', '50645.41', '50511.12', '47659.68', '47137.46', '49379.67', '50117.25',
          '46757.09', '48392.79', '48884.66', '47658.38', '46173.51', '46863.67', '46689.28', '46910.13', '48934.57',
          '48628.35', '50785.69', '50814.92', '50470.89', '50801.11', '50692.3', '47601.26', '46408.87', '47132.96',
          '46249.56', '47763.33', '47327.87', '46441.99', '45862.98', '43436.17', '43120.63', '41528.04', '41690.93',
          '41864.44', '41849.0', '42723.37', '43926.0', '42546.44', '43099.37', '43146.53', '43102.44', '42248.35',
          '42381.48', '41707.85', '40684.42', '36480.85', '35071.43', '36280.82', '36678.82', '36948.81', '36823.5',
          '37146.85', '37770.15', '38186.49', '37918.62', '38521.79', '38739.74', '36912.68', '37092.4', '41584.19',
          '41435.43', '42450.98', '43834.02', '44133.28', '44397.3', '43531.11', '42401.27', '42245.56', '42104.89',
          '42580.94', '44536.2', '43948.81', '40565.69', '40014.55', '40115.05']

highmat = ['55916.5', '56001.2', '57487.86', '54123.4', '48880.43', '50624.84', '46800.42', '46340.31', '46155.87',
          '45113.92', '49618.43', '48356.04', '50477.7', '48448.91', '48861.38', '48881.59', '51169.7', '52299.33',
          '54881.52', '55997.23', '57764.0', '57253.28', '61258.73', '59133.47', '55754.72', '56872.38', '58913.0',
          '57665.9', '58075.1', '58085.8', '57411.17', '54204.96', '54477.46', '52508.23', '51415.92', '55074.47',
          '55863.93', '55783.71', '57627.67', '58730.13', '58735.25', '58736.92', '59031.32', '57076.49', '58206.55',
          '59054.1', '58020.46', '55947.27', '58048.59', '58102.58', '59774.0', '59964.87', '59834.74', '63554.44',
          '62969.12', '63252.63', '61455.98', '60087.09', '56251.48', '55703.14', '56507.91', '53808.8', '51731.71',
          '51153.13', '50110.53', '49075.58', '54056.64', '55071.46', '54884.1', '53584.15', '57796.62', '57857.5',
          '56610.46', '57213.33', '53241.72', '57473.23', '56428.16', '57380.27', '58928.81', '58280.73', '55883.5',
          '56750.0', '49007.09', '49702.27', '49922.52', '46736.58', '46441.64', '43596.24', '42912.19', '36964.27',
          '40784.32', '37280.35', '37528.3', '34754.54', '38728.59', '38410.5', '39266.04', '38445.29', '35689.62',
          '34647.67', '35684.59', '37310.54', '36662.64', '37585.24', '39188.59', '36885.51', '35530.38', '35816.17',
          '33514.87', '33450.19', '37338.36', '36704.57', '37313.18', '35494.9', '39066.82', '40525.8', '40188.56',
          '38324.87', '38068.04', '35729.82', '35524.17', '35592.35', '31686.55', '32447.59', '33674.66', '34639.38',
          '31640.58', '32160.91', '34644.45', '34456.67', '35847.7', '35047.36', '33536.88', '33856.86', '34688.98',
          '35309.3', '33747.97', '34211.01', '33839.04', '32877.41', '33818.52', '33515.57', '34227.64', '33158.25',
          '32686.56', '32814.61', '31738.59', '31421.25', '31520.66', '31783.49', '30815.94', '29790.24', '32118.06',
          '32297.89', '33581.63', '34279.34', '35365.2', '37318.14', '39405.95', '40002.53', '40005.93', '42214.15',
          '41659.06', '40000.46', '39193.94', '38138.0', '39750.14', '40882.0', '42825.95', '44634.13', '43816.14',
          '46333.46', '45608.37', '45611.46', '44417.78', '47833.98', '47112.19', '47056.41', '45982.55', '44648.57',
          '44777.86', '46734.65', '49327.75', '48932.02', '49335.68', '49523.5', '47744.58', '48972.09', '46962.8',
          '49056.86', '48897.65', '48806.78', '47074.77', '47155.87', '48862.76', '49329.01', '50035.33', '49947.38',
          '51769.06', '52677.4', '46809.17', '46078.38', '46368.69', '44847.48', '45144.79', '46059.12', '44968.76',
          '47072.12', '48167.85', '47785.26', '47263.6', '48259.45', '47249.38', '42901.56', '40619.27', '43604.76',
          '44888.96', '42815.56', '42742.01', '43182.63', '42238.2', '41011.16', '41522.38', '43757.81', '48140.11',
          '47727.1', '48205.72', '49143.95', '51505.83', '55343.76', '53801.1', '53867.3', '55122.59', '54625.74',
          '57452.01', '56242.94', '57406.69', '57397.74', '61641.17', '60948.78', '61546.21', '61971.59', '64287.64',
          '66063.56', '62354.86', '60697.06', '61277.28', '60884.18', '63070.54', '60345.17', '58538.49', '60587.09',
          '62249.18', '61731.29', '61373.44', '61029.5', '63241.11', '62954.86', '61441.83', '61072.32', '61516.31',
          '63293.22', '67562.17', '66954.11', '64976.73', '64838.81', '64254.67', '64420.94', '65468.75', '63584.25',
          '60172.26', '60381.35', '56921.34', '58133.02', '59777.98', '58755.9', '56301.52', '57578.22', '57187.54',
          '58935.45', '53588.21', '54801.15', '57292.28', '57828.45', '57025.79', '57229.76', '56508.48', '53713.84',
          '49253.86', '49380.43', '50564.63', '50645.41', '50511.12', '47659.68', '47137.46', '49379.67', '50117.25',
          '46757.09', '48392.79', '48884.66', '47658.38', '46173.51', '46863.67', '46689.28', '46910.13', '48934.57',
          '48628.35', '50785.69', '50814.92', '50470.89', '50801.11', '50692.3', '47601.26', '46408.87', '47132.96',
          '46249.56', '47763.33', '47327.87', '46441.99', '45862.98', '43436.17', '43120.63', '41528.04', '41690.93',
          '41864.44', '41849.0', '42723.37', '43926.0', '42546.44', '43099.37', '43146.53', '43102.44', '42248.35',
          '42381.48', '41707.85', '40684.42', '36480.85', '35071.43', '36280.82', '36678.82', '36948.81', '36823.5',
          '37146.85', '37770.15', '38186.49', '37918.62', '38521.79', '38739.74', '36912.68', '37092.4', '41584.19',
          '41435.43', '42450.98', '43834.02', '44133.28', '44397.3', '43531.11', '42401.27', '42245.56', '42104.89',
          '42580.94', '44536.2', '43948.81', '40565.69', '40014.55', '40115.05']
lowmat = ['55916.5', '56001.2', '57487.86', '54123.4', '48880.43', '50624.84', '46800.42', '46340.31', '46155.87',
          '45113.92', '49618.43', '48356.04', '50477.7', '48448.91', '48861.38', '48881.59', '51169.7', '52299.33',
          '54881.52', '55997.23', '57764.0', '57253.28', '61258.73', '59133.47', '55754.72', '56872.38', '58913.0',
          '57665.9', '58075.1', '58085.8', '57411.17', '54204.96', '54477.46', '52508.23', '51415.92', '55074.47',
          '55863.93', '55783.71', '57627.67', '58730.13', '58735.25', '58736.92', '59031.32', '57076.49', '58206.55',
          '59054.1', '58020.46', '55947.27', '58048.59', '58102.58', '59774.0', '59964.87', '59834.74', '63554.44',
          '62969.12', '63252.63', '61455.98', '60087.09', '56251.48', '55703.14', '56507.91', '53808.8', '51731.71',
          '51153.13', '50110.53', '49075.58', '54056.64', '55071.46', '54884.1', '53584.15', '57796.62', '57857.5',
          '56610.46', '57213.33', '53241.72', '57473.23', '56428.16', '57380.27', '58928.81', '58280.73', '55883.5',
          '56750.0', '49007.09', '49702.27', '49922.52', '46736.58', '46441.64', '43596.24', '42912.19', '36964.27',
          '40784.32', '37280.35', '37528.3', '34754.54', '38728.59', '38410.5', '39266.04', '38445.29', '35689.62',
          '34647.67', '35684.59', '37310.54', '36662.64', '37585.24', '39188.59', '36885.51', '35530.38', '35816.17',
          '33514.87', '33450.19', '37338.36', '36704.57', '37313.18', '35494.9', '39066.82', '40525.8', '40188.56',
          '38324.87', '38068.04', '35729.82', '35524.17', '35592.35', '31686.55', '32447.59', '33674.66', '34639.38',
          '31640.58', '32160.91', '34644.45', '34456.67', '35847.7', '35047.36', '33536.88', '33856.86', '34688.98',
          '35309.3', '33747.97', '34211.01', '33839.04', '32877.41', '33818.52', '33515.57', '34227.64', '33158.25',
          '32686.56', '32814.61', '31738.59', '31421.25', '31520.66', '31783.49', '30815.94', '29790.24', '32118.06',
          '32297.89', '33581.63', '34279.34', '35365.2', '37318.14', '39405.95', '40002.53', '40005.93', '42214.15',
          '41659.06', '40000.46', '39193.94', '38138.0', '39750.14', '40882.0', '42825.95', '44634.13', '43816.14',
          '46333.46', '45608.37', '45611.46', '44417.78', '47833.98', '47112.19', '47056.41', '45982.55', '44648.57',
          '44777.86', '46734.65', '49327.75', '48932.02', '49335.68', '49523.5', '47744.58', '48972.09', '46962.8',
          '49056.86', '48897.65', '48806.78', '47074.77', '47155.87', '48862.76', '49329.01', '50035.33', '49947.38',
          '51769.06', '52677.4', '46809.17', '46078.38', '46368.69', '44847.48', '45144.79', '46059.12', '44968.76',
          '47072.12', '48167.85', '47785.26', '47263.6', '48259.45', '47249.38', '42901.56', '40619.27', '43604.76',
          '44888.96', '42815.56', '42742.01', '43182.63', '42238.2', '41011.16', '41522.38', '43757.81', '48140.11',
          '47727.1', '48205.72', '49143.95', '51505.83', '55343.76', '53801.1', '53867.3', '55122.59', '54625.74',
          '57452.01', '56242.94', '57406.69', '57397.74', '61641.17', '60948.78', '61546.21', '61971.59', '64287.64',
          '66063.56', '62354.86', '60697.06', '61277.28', '60884.18', '63070.54', '60345.17', '58538.49', '60587.09',
          '62249.18', '61731.29', '61373.44', '61029.5', '63241.11', '62954.86', '61441.83', '61072.32', '61516.31',
          '63293.22', '67562.17', '66954.11', '64976.73', '64838.81', '64254.67', '64420.94', '65468.75', '63584.25',
          '60172.26', '60381.35', '56921.34', '58133.02', '59777.98', '58755.9', '56301.52', '57578.22', '57187.54',
          '58935.45', '53588.21', '54801.15', '57292.28', '57828.45', '57025.79', '57229.76', '56508.48', '53713.84',
          '49253.86', '49380.43', '50564.63', '50645.41', '50511.12', '47659.68', '47137.46', '49379.67', '50117.25',
          '46757.09', '48392.79', '48884.66', '47658.38', '46173.51', '46863.67', '46689.28', '46910.13', '48934.57',
          '48628.35', '50785.69', '50814.92', '50470.89', '50801.11', '50692.3', '47601.26', '46408.87', '47132.96',
          '46249.56', '47763.33', '47327.87', '46441.99', '45862.98', '43436.17', '43120.63', '41528.04', '41690.93',
          '41864.44', '41849.0', '42723.37', '43926.0', '42546.44', '43099.37', '43146.53', '43102.44', '42248.35',
          '42381.48', '41707.85', '40684.42', '36480.85', '35071.43', '36280.82', '36678.82', '36948.81', '36823.5',
          '37146.85', '37770.15', '38186.49', '37918.62', '38521.79', '38739.74', '36912.68', '37092.4', '41584.19',
          '41435.43', '42450.98', '43834.02', '44133.28', '44397.3', '43531.11', '42401.27', '42245.56', '42104.89',
          '42580.94', '44536.2', '43948.81', '40565.69', '40014.55', '40115.05']
lenght_rsi = 0
rsi_current = 0
rsi_son_float = 0
countrsi = 0
series = range(50)


def price():
    time.sleep(15)
    global countrsi

    client = Client(api_key=key.Pkey, api_secret=key.Skey)

    price = client.get_ticker(symbol='BTCBUSD')
    coiprice = format(float(price['askPrice']), )
    highprice = format(float(price['highPrice']), )
    lowprice = format(float(price['lowPrice']), )

    x11 = float(coiprice)
    x12 = float(highprice)
    x13 = float(lowprice)

    matris.append(x11)
    highmat.append(x12)
    lowmat.append(x13)

    x = len(matris) - 1
    y = len(matris) - 2

    xfloat = matris[x]
    yfloat = matris[y]

    x1 = float(xfloat)
    y1 = float(yfloat)

    percent = round(float(x1 / y1), 5)
    print(percent)
    lenght_rsi = len(matris)
    print(countrsi)
    data = pd.DataFrame(matris, columns=['close'])
    data4 = pd.DataFrame(highmat, columns=['high'])
    data3 = pd.DataFrame(lowmat, columns=['low'])





    movingaverageresult = mov.movingaverage(data, x11)

    print(movingaverageresult[0])
    print(movingaverageresult[1])

    macd1 = ta.rsi(data['close'], length=14)
    # print(macd1)
    macd2 = ta.rsi(data['close'], length=28)
    macd3 = ta.macd(data['close'], fast=14, slow=28)
    a = np.array(macd2.values.tolist())
    y = (a[-50:])  # son 50 rsi verisi
    z = (matris[-50:])

    m1 = y[40]
    m2 = y[0]
    print('-----')
    print(m2 / m1)
    print('-----')

    m11 = float(z[40])
    m21 = float(z[0])
    print('-----')
    print(m21 / m11)
    print('-----')
    # print(macd3 )
    data2 = pd.concat([data, macd1, macd2, macd3,data3,data4], axis=1)

    ys = np.array(y, dtype=np.float64)
    xs = np.array(series, dtype=int)

    (slope, intercept, rvalue, pvalue, stderr) = linregress(xs, ys)
    print("slope: %f    intercept: %f" % (slope, intercept))

    print(data2.tail(10))

    print(lenght_rsi)
    if lenght_rsi > 50:
        if countrsi == 0:

            if macd1.iloc[-1] < 30:
                print('but Btc')
                countrsi = 1
                tele.telegram_bot(macd1.iloc[-1])
                tele.telegram_bot(macd2.iloc[-1])
                tele.telegram_bot(coiprice)

            elif macd1.iloc[-1] > 70:
                print('sell btc')
                countrsi = 1
                tele.telegram_bot(macd1.iloc[-1])
                tele.telegram_bot(macd2.iloc[-1])
                tele.telegram_bot(coiprice)

        elif macd1.iloc[-1] in range(30, 69):
            countrsi = 0

    if lenght_rsi > 50:
        if percent < 0.99:
            tele.telegram_bot(macd1.iloc[-1])
            tele.telegram_bot(macd2.iloc[-1])
            tele.telegram_bot(coiprice)

        elif percent > 1.01:
            tele.telegram_bot(macd1.iloc[-1])
            tele.telegram_bot(macd2.iloc[-1])
            tele.telegram_bot(coiprice)

    if x1 > y1:
        print('yukseliyor')


    else:
        print('dusuyor')


while True:
    price()
